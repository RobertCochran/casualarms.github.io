---
permalink: /staff/leaderboards/index.html
---
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Leaderboard Tools - Casual ARMS</title>
	<script src="/script/general.js"></script>
	<script src="/data/support.js"></script>
	<style>
	
	@font-face {
		font-family: 'ARMS';
		src: url("/assets/ARMSARMSv1.001.ttf");
	}
	
	body {
		background-color: #2f3136;
		color: #c3c4c6;
		font-family: sans-serif;
	}
	
	#wrapper {
		width: 40em;
		margin: 0 auto;
		padding: 1em 2em;
		background-color: #36393f;
	}
	
	h1, h2, h3, h4 {
		border-bottom: 1pt solid #3e4147;
		padding-bottom: 0.25em;
	}
	
	textarea {
		background-color: #484b52;
		color: white;
		width: 100%;
		font-family: monospace;
	}
	
	#formatted {
		background-color: black;
		color: white;
	}
	
	#input, #previous, #format-text-button, #compare-text-button {
		display: none;
	}
	
	</style>
	<script>
	
	// Merges entries with unknown ID
	function mergeData(d_old, d_new)
	{
		var result = {};
		for (var i = 0; i <  d_old.length; ++i)
		{
			var name = d_old[i][0];
			if (result[name] == undefined) result[name] = [-1,-1];
			result[name][0] = d_old[i][1];
		}
		for (var i = 0; i <  d_new.length; ++i)
		{
			var name = d_new[i][0];
			if (result[name] == undefined) result[name] = [-1,-1];
			result[name][1] = d_new[i][1];
		}
		return result;
	}

	
	function compare(useTiers, dataNew, dataOld)
	{
		// Prepare result
		var newroles = {};
		for (var t = useTiers.length-1; t >= 0; --t)
			newroles[useTiers[t].name] = [];
		
		
		// Handle players with known IDs
		for (key in dataNew)
		{
			if (key == "UNKNOWN") continue;
			
			var newCoins = dataNew[key].coins;
			var oldCoins = (dataOld[key] != undefined) ? dataOld[key].coins : 0;
			
			for (var t = useTiers.length-1; t >= 0; --t)
			{
				if (newCoins >= useTiers[t].start && oldCoins < useTiers[t].start)
				{
					newroles[useTiers[t].name].push(dataNew[key].name);
					break;
				}
			}
		}
		
		
		// Handle players with unknown IDs
		var merged = mergeData(dataOld.UNKNOWN, dataNew.UNKNOWN);
		for (var name in merged)
		{
			var player = merged[name];
			for (var t = useTiers.length-1; t >= 0; --t)
			{
				if (player[1] >= useTiers[t].start && player[0] < useTiers[t].start)
				{
					newroles[useTiers[t].name].push(name);
					break;
				}
			}
		}
		
		
		// Output result
		var output = "";
		for (var t = useTiers.length-2; t > 0; --t)
		{
			var tierName = useTiers[t].name;
			output += "<h4 style='color: " + useTiers[t].color + ";'>" + tierName + "</h4><ul>";
			for (name in newroles[tierName])
				output += "<li>" + newroles[tierName][name] + "</li>";
			
			output += "</ul>";
		}
		
		$("newroles").innerHTML = output;
	}
	
	
	
	function parseData(text)
	{
		var rows = text.split(/[\r\n]+/);
		var data = {};
		var unknowns = [];
		
		for (var i = 1; i < rows.length; ++i)
		{
			var row = rows[i].split(",");
			var userName = row[1];
			var userID = row[0];
			
			var monthly = parseInt(row[3]);
			if (!monthly) monthly = 0;
			
			if (userID == "UNKNOWN")
				unknowns.push([userName, parseInt(row[2]), monthly]);
			else
				data[userID] = {"name" : userName, "coins" : parseInt(row[2]), "monthly" : monthly};
		}
		
		data["UNKNOWN"] = unknowns;
		return data;
	}
	
	
	var reader = new FileReader();
	
	reader.onloadend = function(event)
	{
		var dataNew = parseData(reader.result);
		$("formatted-for-web").value = JSON.stringify(dataNew);
		
		var mode = ["arms", "mariokart"][$("mode").selectedIndex];
		var useTiers = [leaderboardTiers, leaderboardTiersMarioKart][$("mode").selectedIndex];
		
		
		var callback = function(dataOld)
		{
			compare(useTiers, dataNew, dataOld);
		}
		
		
		fetchLeaderboards(mode, callback);
	}
	
	function formatFile()
	{
		var selectedFile = $("file-new").files[0];
		reader.readAsText(selectedFile);
	}
	
	</script>
</head>
<body>
	<div id="wrapper">
		<h1>Casual ARMS Leaderboard Tools</h1>
		
		<p>Mode:
			<select id="mode">
				<option value="0">ARMS</option>
				<option value="1">Mario Kart</option>
			</select>
		</p>
		
		<h2>Input</h2>
		<input type="file" id="file-new"/><button onCLick="formatFile()">Read and Format File</button>
		<br/>
		
		<h3>JSON Leaderboard</h3>
		<textarea id="formatted-for-web" rows="15"></textarea>
		
		<h3>New Roles</h3>
		<div id="newroles"></div>
	</div>
</body>
</html>
