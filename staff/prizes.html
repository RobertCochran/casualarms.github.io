---
permalink: /staff/prizes/index.html
---
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Prize Randomizer - Casual ARMS</title>
	<script src="/script/general.js"></script>
	<script src="/data/support.js"></script>
	<style>
	
	@font-face {
		font-family: 'ARMS';
		src: url("../../ARMSARMSv1.001.ttf");
	}
	
	body {
		background-color: #2f3136;
		color: #c3c4c6;
		font-family: sans-serif;
	}
	
	#wrapper {
		width: 40em;
		margin: 0 auto;
		padding: 1em 2em;
		background-color: #36393f;
	}
	
	h1, h2, h3, h4 {
		border-bottom: 1pt solid #3e4147;
		padding-bottom: 0.25em;
	}
	
	textarea {
		background-color: #484b52;
		color: white;
		width: 100%;
		font-family: monospace;
	}
	
	#formatted {
		background-color: black;
		color: white;
	}
	
	</style>
	<script>
	
	function padString(str, paddingValue)
	{
		return String(str + paddingValue).slice(0, paddingValue.length);
	};

	function process()
	{
		var input = $("input").value;
		
		var lines = input.split(/\r?\n/g);
		
		var scores = [];
		var sumscores = 0;
		
		for (var line in lines)
		{
			var split = lines[line].split(/\s/g).filter(function(item) { return item != "" && item != "-"; });
			var offset = (split[2][0] == "(") ? 1 : 0;
			var score = parseFloat(split[7+offset]);
			scores.push([split[1], score, 0]);
			sumscores += score;
		}
		
		var raffle = [];
		for (var p = 0; p < scores.length; ++p)
			for (var i = 0; i < scores[p][1]*2; ++i)
				raffle.push(scores[p][0]);
		
		var rolls = parseInt($("rolls").value);
		for (var r = 0; r < rolls; ++r)
		{
			var winner = raffle[Math.floor(Math.random() * raffle.length)];
			for (var p = 0; p < scores.length; ++p)
				if (scores[p][0] == winner)
					scores[p][2]++;
		}
		
		var text = "";
		for (var p = 0; p < scores.length; ++p)
		{
			var expected = scores[p][1] / sumscores * rolls;
			text += padString(scores[p][0], "                        ") + scores[p][2] + " (expected " + expected +  ")\n";
		}
		
		$("result").value = text;
	}
	
	var rawSeasonHistory = { arms: null, kart: null, splat: null, smash: null };
	var seasonHistory    = { arms: null, kart: null, splat: null, smash: null };
	
	function storeSeasons(rawBoards)
	{
		var games = ["arms", "kart", "splat", "smash"];
		for (var gi = 0; gi < games.length; ++gi)
		{
			rawSeasonHistory[games[gi]] = [];
			seasonHistory[games[gi]] = [];
			for (var i = 0; i < rawBoards[games[gi]].length; ++i)
			{
				var season = {};
				season.title = monthNames[rawBoards[games[gi]][i].month-1] + " " + rawBoards[games[gi]][i].year;
				season.data = reorganizeLeaderboards(rawBoards[games[gi]][i].leaderboard);
				seasonHistory[games[gi]].push(season);
				
				var copyboard = season.data.slice().sort(function(a, b) { return b.monthly - a.monthly; });
				var rawSeason = {};
				var previous = -1;
				var duplicates = 0;
				
				for (var si = 0; si < copyboard.length && copyboard[si].monthly > 0; ++si)
				{
					duplicates = (copyboard[si].monthly == previous) ? duplicates + 1 : 0;
					previous = copyboard[si].monthly;
					rawSeason[copyboard[si].id] = si + 1 - duplicates;
				}
				rawSeasonHistory[games[gi]].push(rawSeason);
			}
		}
		
		var options = "";
		for (var game in eventGames)
			options += "<option value='" + game + "'>" + eventGames[game] + "</option>";
		$("game").innerHTML = options;
		
		changeGame();
	}
	
	function processMonthly(useBoard)
	{
		var game = $("game").value;
		var activeSeasonIndex = $("season").selectedIndex;
		useBoard = seasonHistory[game][activeSeasonIndex].data;
		var copyboard = useBoard.slice().filter(function (item) { return item.monthly > 0; }).sort(function(a, b) { return b.monthly - a.monthly; });
		
		var scores = [];
		var sumscores = 0;
		var previous = -1;
		var duplicates = 0;
		for (var i = 0; i < copyboard.length && copyboard[i].monthly > 0; ++i)
		{
			duplicates = (copyboard[i].monthly == previous) ? duplicates + 1 : 0;
			previous = copyboard[i].monthly;
			var useIndex = i + 1 - duplicates;
			var score = copyboard.length - useIndex + 1;
			scores.push({name:copyboard[i].name, score:score, wins:0});
			sumscores += score;
		}
		
		var raffle = [];
		for (var p = 0; p < scores.length; ++p)
			for (var i = 0; i < scores[p].score; ++i)
				raffle.push(scores[p].name);
		
		var rolls = parseInt($("rolls").value);
		for (var r = 0; r < rolls; ++r)
		{
			var winner = raffle[Math.floor(Math.random() * raffle.length)];
			for (var p = 0; p < scores.length; ++p)
				if (scores[p].name == winner)
					scores[p].wins++;
		}
		
		var text = "";
		for (var p = 0; p < scores.length; ++p)
		{
			var expected = scores[p].score / sumscores * rolls;
			text += padString(scores[p].score, "   ") + padString(scores[p].name, "                        ") + scores[p].wins + " (expected " + expected +  ")\n";
		}
		
		$("result-monthly").value = text;
	}
	
	function load()
	{
		fetchSeasonHistory(storeSeasons);
	}
	
	function changeGame()
	{
		var game = $("game").value;
		var today = new Date();
		var options = "";
		for (var i = 0; i < seasonHistory[game].length; ++i)
			options += "<option value='" + (i+1) +"'>" + seasonHistory[game][i].title + "</option>";
		$("season").innerHTML = options;
	}
	
	</script>
</head>
<body onload="load()">
	<div id="wrapper">
		<h1>Casual ARMS Prize Randomizer</h1>
		
		<h2>Input</h2>
		<p>Rolls: <input type="number" value="1" id="rolls"/></p>
		<textarea id="input" rows="10"></textarea>
		<button onCLick="process()">Process </button>
		<br/>
		
		<h3>Results</h3>
		<textarea id="result" rows="30"></textarea>
		
		
		<h3>Monthly Giveaway</h3>
		
		<p>
			<select id="game" onChange="changeGame()"></select>
			<select id="season"></select>
			<button onCLick="processMonthly()">Process Monthly</button>
		</p>
		<textarea id="result-monthly" rows="30"></textarea>
		
	</div>
</body>
</html>
