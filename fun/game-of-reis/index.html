<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<style>
	body {
		margin: 0px;
		padding: 0px;
	}
	
	canvas {
		display: block;
		background-color: green;
		margin: 0 auto;
	}
	</style>
</head>
<body>
	<img id="room" src="room.png" style="display: none;"/>
	<img id="mug" src="mug.png" style="display: none;"/>
	<img id="princess" src="princess.png" style="display: none;"/>
	<img id="hair" src="hair.png" style="display: none;"/>
	<canvas id="myCanvas" width="300" height="400"></canvas>
	<script>
	var canvas = document.getElementById('myCanvas');
	var context = canvas.getContext('2d');
	var FPS = 30;
	var mousePos = { x:150, y: 350};
	
	var room = document.getElementById("room");
	var mug = document.getElementById("mug");
	var princess = document.getElementById("princess");
	var hair = document.getElementById("hair");
	
	var Px = 0;
	var Pd = 0;
	
	var hairs = [];
	var hairCounter = 0;
	var hairInterval = 30;
	var hairSpeed = 5;
	
	var lives = 3;
	var score = 0;
	
	var stopped = true;
	
	setInterval(function()
	{
		update();
		draw();
	}, 1000/FPS);
	
	function update()
	{
		if (!stopped)
		{
			score++;
			
			if (Pd == 0) Px += 10;
			if (Pd == 1) Px -= 10;
			if (Px > 240) Pd = 1;
			if (Px < -30) Pd = 0;
			
			hairCounter ++;
			if (hairCounter == hairInterval)
			{
				hairs.push({x:Px, y:50});
				hairCounter = 0;
				hairSpeed += 1;
				hairInterval = Math.max(hairInterval - 1, 10);
			}
			
			
			var i = 0;
			while (i < hairs.length)
			{
				hairs[i].y += hairSpeed;
				
				var diffX = mousePos.x - hairs[i].x;
				var diffY = mousePos.y - hairs[i].y;
				
				var distance = Math.sqrt(diffX*diffX + diffY*diffY);
				if (distance < 50)
				{
					hairs.splice(i, 1);
					lives--;
					if (lives == 0)
					{
						stopped = true;
					}
				}
				
				else if (hairs[i].y > 400)
					hairs.splice(i, 1);
				else
					i++;
			}
		}
	}
	
	function draw()
	{
		context.clearRect(0, 0, canvas.width, canvas.height);
		
		context.drawImage(room, 0, 0);
		context.drawImage(princess, Px, -30);
		context.drawImage(mug, mousePos.x - 50, mousePos.y - 36);
		
		for (var i = 0; i < hairs.length; ++i)
			context.drawImage(hair, hairs[i].x - 7, hairs[i].y - 7);
		
		var lifeText = "";
		for (var i = 0; i < lives; ++i)
			lifeText += "ðŸ¤“";
		
		var message = 'Score: ' + score + ' Lives: ' + lifeText;
		writeMessage(message, 10, 390);
		
		if (stopped)
			writeMessage("Click to start", 10, 40);
	}
	
	function writeMessage(message, x, y)
	{
		context.font = '14pt Courier, Courier New';
		context.fillStyle = 'white';
		context.fillText(message, x, y);
	}
	
	function getMousePos(canvas, evt)
	{
		var rect = canvas.getBoundingClientRect();
		mousePos = {
			x: Math.max(50, Math.min(evt.clientX - rect.left, 250)),
			y: Math.max(250, Math.min(evt.clientY - rect.top, 400))
		};
	}
	
	canvas.addEventListener('click', function(evt)
	{
		if (stopped)
		{
			stopped = false;
			lives = 3;
			score = 0;
			hairCounter = 0;
			hairInterval = 30;
			hairSpeed = 5;
		}
		else
		{
			stopped = true;
		}
	}, false);

	canvas.addEventListener('mousemove', function(evt)
	{
		var mousePos = getMousePos(canvas, evt);
	}, false);
	</script>
</body>
</html>
