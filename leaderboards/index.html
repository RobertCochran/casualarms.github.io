<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Leaderboards â€“ Casual ARMS</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../style.css">
	<script src="../events.js" charset="UTF-8"></script>
	<script src="../script.js"></script>
	<style>
	
	h3 { background-color: black; }
	
	p.limits {
		font-size: 1.2em;
		font-style: italic;
		font-weight: bold;
		color: yellow;
		margin-top: -0.5em;
		text-align: center;
	}
	
	#leaderboard .tier {
		max-width: 330pt;
		margin: 0 auto;
	}
	
	#leaderboard p.entry {
		background-color: #171717;
		line-height: 0.9em;
		padding: 0 8pt 0pt 4pt;
		margin: 12pt 2pt 12pt 40pt;
		position: relative;
		transition: 0.2s;
		border-top-left-radius: 15pt 100%;
		border-bottom-right-radius: 15pt 100%;
		cursor: pointer;
	}
	
	.index {
		display: inline-block;
		width: 35pt;
		margin: -4pt 0 -4pt -24pt;
		line-height: 32pt;
		text-align: center;
		color: white;
		font-size: 1.3em;
		font-style: italic;
		font-weight: bold;
		background-size: 35pt;
		background-repeat: no-repeat;
		position: relative;
		left: -22pt;
		transition: 0.2s;
		
	}
	
	.small .index {
		font-size: 1em;
	}
	
	.player {
		max-width: 65%;
		display: inline-block;
		margin-top: 5pt;
	}
	
	.coins {
		display: inline-block;
		font-size: 1.2em;
		font-style: italic;
		font-weight: bold;
		color: yellow;
		float: right;
		line-height: 24pt;
		padding-right: 24pt;
	}
	
	.armscoin {
		position: absolute;
		width: 17pt;
		right: 10pt;
		top: 3pt;
	}
	
	#leaderboard p.entry:hover {
		background-color: yellow;
		color: black !important;
	}
	
	#leaderboard p.entry:hover .coins {
		color: black;
	}
	
	.coin-dark, p.entry:hover .coin-yellow {
		opacity: 0;
	}
	
	p.entry:hover .coin-dark {
		opacity: 1;
	}
	
	#leaderboard p.entry:hover .index {
		transform: scale(1.5);
	}
	
	
	p.entry.basic .index {
		background-image: url(placement-basic.png);
		color: black;
	}
	
	#sponsor {
		background-color: black;
		border: 2pt solid yellow;
		max-width: 400pt;
		min-height: 40pt;
		position: relative;
		margin: 0 auto;
		padding: 5pt;
	}
	
	#sponsor span {
		display: inline-block;
		width: 80%;
		color: yellow;
		text-align: center;
		font-size: 1.2em;
		display: inline-block;
		margin-right: 20%;
	}
	
	#sponsor img {
		height: 40pt;
		position: absolute;
		right: 5pt; top: 5pt;
	}
	
	
	.badge-stash {
		width: 100%;
		background-color: #222;
		padding: 10pt;
		box-shadow: 0px 2px 3px #000 inset;
		box-sizing: border-box;
		text-align: center;
		display: none;
		transition: height 0.3s;
		overflow: hidden;
		height: 0;
	}
	
	.badge-container {
		display: inline-block;
		position: relative;
		width: 32pt;
		height: 32pt;
		margin: 5pt;
	}
	
	.badge-image {
		position: absolute;
		top: 0; left: 0;
		width: 100%;
		height: 100%;
		border-radius: 100%;
	}
	
	.badge-overlay {
		position: absolute;
		top: 0; left: 0;
		width: 100%;
		height: 100%;
	}
	
	
	#mode-selector {
		text-align: center;
		font-family: ARMS;
		font-size: 1.3em;
		text-transform: uppercase;
	}
	
	.mode {
		padding: 3pt 12pt;
		line-height: 2.2em;
		cursor: pointer;
	}
	
	.mode.active-mode {
		background-color: yellow;
		color: black;
	}
	
	</style>
	<script>
	
	function showBadges(member, uid)
	{
		console.log("show badges for " + uid);
		var stash = document.getElementById(member);
		var display = stash.style.display;
		stash.style.display = (display != "block" ? "block" : "none");
		
		user_badges = [];
		
		// Manual badges
		if (badges.hasOwnProperty(uid))
		{
			for (var i = 0; i < badges[uid].length; ++i)
			{
				user_badges.push(badges[uid][i]);
			}
		}
		
		// Patreon badges
		if (rawPatrons.hasOwnProperty(uid))
		{
			if (rawPatrons[uid].tier >= 1) user_badges.push("p0");
			if (rawPatrons[uid].tier >= 2) user_badges.push("p1");
			if (rawPatrons[uid].tier >= 3) user_badges.push("p2");
		}
		
		// Leaderboard badges
		if (rawLeaderboard.hasOwnProperty(uid))
		{
			for (var i = 0; i < leaderboardTiers.length; ++i)
			{
				if (rawLeaderboard[uid].coins > leaderboardTiers[i].start)
					user_badges.push("ldb" + i);
			}
		}
		
		if (user_badges.length > 0)
		{
			html = "";
			for (var i = 0; i < user_badges.length; ++i)
			{
				var badgeKey = user_badges[i];
				var badge = badgeList[badgeKey];
				html += "<div class='badge-container' title='" + badge.caption + "'>";
				html += "<img class='badge-image' src='/badges/" + badgeKey + ".png'/>";
				html += "<img class='badge-overlay' src='/badges/overlay-" + badge.style + ".png'/>";
				html += "</div>";
			}
			stash.innerHTML = html;
		}
		
		stash.style.height = "auto";
	}
	
	var rawLeaderboard = null;
	var leaderboard = null;
	var badges = null;
	
	var rawPatrons = null;
	var patrons = null;
	
	function finalizeLoading()
	{
		console.log("in here!");
		if (leaderboard && badges && patrons)
		{
			var anchor = window.location.hash.substring(1);
			switch (anchor)
			{
			case "monthly":
				changeMode(1)
				break;
			case "patrons":
				changeMode(2)
				break;
			default:
				changeMode(0);
			}
		}
	}
	
	function storeLeaderboards(rawBoards)
	{
		rawLeaderboard = rawBoards;
		leaderboard = reorganizeLeaderboards(rawBoards);
		finalizeLoading();
	}
	
	function storePatrons(getPatrons)
	{
		rawPatrons = getPatrons;
		pat = [];
		for (var key in getPatrons)
		{
			if (getPatrons.hasOwnProperty(key) && key != "UNKNOWN")
			{
				var user = getPatrons[key];
				pat.push([user.name, user.tier, key]);
			}
		}
		for (var i = 0; i < getPatrons.UNKNOWN.length; ++i)
			pat.push([getPatrons.UNKNOWN[i].name, getPatrons.UNKNOWN[i].tier, null]);
		
		pat.sort(function(a, b) { return b[1] - a[1]; });
		patrons = pat;
		finalizeLoading();
	}
	
	function storeBadges(getBadges)
	{
		badges = getBadges;
		finalizeLoading();
	}
	
	function displayLeaderboards()
	{
		var menu_html = "<div class='menu-container'>";
		var html = "";
		var css = "";
		
		var scrolltoid = null;
		var tc = leaderboardTiers.length-1;
		var index = 1;
		
		for (var i = 0; i < leaderboard.length; ++i)
		{
			var coins = leaderboard[i][1];
			
			if (coins == 0)
				break;
			else if (coins < leaderboardTiers[tc].start)
			{
				tc--;
				index = 1;
				var tierName = leaderboardTiers[tc].name;
				html += "</div><h3 id='tier-" + tierName + "' style='color: " + leaderboardTiers[tc].color + ";'>ARMS Labs " + tierName + "</h3><div class='tier'>";
				html += "<p class='limits'>" + leaderboardTiers[tc].start + " <img class='armscoin-text' src='coin.png'/> &#8211; " + (leaderboardTiers[tc+1].start-1) + " <img class='armscoin-text' src='coin.png'/></p>";
				
				// Build menu
				var tierName = leaderboardTiers[tc].name;
				var style = "style='color: " + leaderboardTiers[tc].color + ";'";
				menu_html += "<a class='menu-item m5 tier-" + tierName + "' href='#tier-" + tierName + "'" + style + ">ARMS Labs " + tierName + "</a>";
				
				if (window.location.hash.substring(1) == tierName)
					scrolltoid = tierName;
				
				// Generate CSS
				css += "p.entry.tier-" + tierName + ":hover, a.menu-item.tier-" + tierName + ":hover ";
				css += "{ background-color: " + leaderboardTiers[tc].color + " !important; color: black !important; }";
				css += "p.entry.tier-" + tierName + " .index " + "{ background-image: url(placement-" + tierName.toLowerCase() + ".png); color: black; }";
			}
			
			var pid = "badges-leaderboard-" + tc + "-" + index;
			html += "<p onclick=showBadges('" + pid + "','" + leaderboard[i][3] + "'); class='entry tier-" + leaderboardTiers[tc].name + ((index > 99) ? " small" : "") + "' style='color: " + leaderboardTiers[tc].color + ";'><span class='index'>" + (index++) + "</span>";
			html += "<span class='player'>" + leaderboard[i][0] + "</span>";
			html += "<span class='coins'>" + coins + "<img class='armscoin coin-yellow' src='coin.png'/><img class='armscoin coin-dark' src='coin-dark.png'/></span></p>";
			
			html += "<div class='badge-stash' id='" + pid + "'>A Discord connection is required for badge collection!</div>";
		}
		
		menu_html += "</div>";
		html += "</div>";
		document.getElementById("leaderboard").innerHTML = menu_html + html;
		
		// Add CSS
		var style = document.createElement('style');
		style.appendChild(document.createTextNode(css));
		document.getElementsByTagName('head')[0].appendChild(style);
	}
	
	function displayMonthly()
	{
		console.log(leaderboard);
		var index = 1;
		var html = "<div class='tier'>";
		for (var i = 0; i < leaderboard.length; ++i)
		{
			var coins = leaderboard[i][2];
			if (coins > 0)
			{
				var pid = "badges-monthly-" + i;
				html += "<p onclick=showBadges('" + pid + "','" + leaderboard[i][3] + "'); class='entry basic" + ((index > 99) ? " small" : "") + "' style='color: white;'><span class='index'>" + index++ + "</span>";
				html += "<span class='player'>" + leaderboard[i][0] + "</span>";
				html += "<span class='coins'>" + coins + "<img class='armscoin coin-yellow' src='coin.png'/><img class='armscoin coin-dark' src='coin-dark.png'/></span></p>";
				html += "<div class='badge-stash' id='" + pid + "'>A Discord connection is required for badge collection!</div>";
			}
		}
		html += "</div>";
		document.getElementById("leaderboard").innerHTML = html;
	}
	
	function displayPatreon()
	{
		var html = "<p style='text-align: center;'>Contribute to Casual ARMS on <a href='https://www.patreon.com/CasualARMS'><em style='background-color: #f36b61;''>Patreon</em></a>!</p>";
		var css = "";
		var tc = patreonTiers.length;
		var index = 1;
		
		for (var i = 0; i < patrons.length; ++i)
		{
			if (tc != (patrons[i][1]-1))
			{
				if (tc == 0) break;
				
				tc = patrons[i][1]-1;
				index = 1;
				var tierName = patreonTiers[tc].name;
				var tierID = "p" + tc;
				html += "</div><h3 id='tier-" + tierID + "' style='color: " + patreonTiers[tc].color + ";'>" + tierName + "</h3><div class='tier'>";
				html += "<p class='limits' style='color: #f36b61;''>$" + patreonTiers[tc].start + " or more per month</p>";
				
				// Generate CSS
				css += "p.entry.tier-" + tierID + ":hover, a.menu-item.tier-" + tierID + ":hover ";
				css += "{ background-color: " + patreonTiers[tc].color + " !important; color: black !important; }";
				css += "p.entry.tier-" + tierID + " .index " + "{ background-image: url(placement-" + tierID + ".png); color: black; }";
			}
			
			var pid = "badges-patron-" + tc + "-" + index;
			html += "<p onclick=showBadges('" + pid + "','" + patrons[i][2] + "'); class='entry basic tier-" + tierID + ((index > 99) ? " small" : "") + "' style='color: " + patreonTiers[tc].color + ";'><span class='index'>" + (index++) + "</span>";
			html += "<span class='player'>" + patrons[i][0] + "</span>";
		//	html += "<span class='coins'>" + (index) + "<img class='armscoin coin-yellow' src='coin.png'/><img class='armscoin coin-dark' src='coin-dark.png'/></span></p>";
			
			html += "<div class='badge-stash' id='" + pid + "'>A Discord connection is required for badge collection!</div>";
		}
		
		html += "</div>";
		document.getElementById("leaderboard").innerHTML = html;
		
		// Add CSS
		var style = document.createElement('style');
		style.appendChild(document.createTextNode(css));
		document.getElementsByTagName('head')[0].appendChild(style);
	}
	
	
	function changeMode(mode)
	{
		document.getElementById("md0").classList = "mode";
		document.getElementById("md1").classList = "mode";
		document.getElementById("md2").classList = "mode";
		document.getElementById("md" + mode).classList += " active-mode";
		
		if (mode == 0)
			displayLeaderboards();
		else if (mode == 1)
			displayMonthly();
		else if (mode == 2)
			displayPatreon();
		
	}
	
	
	function load()
	{
		fetchLeaderboards(storeLeaderboards);
		fetchPatrons(storePatrons);
		fetchBadges(storeBadges);
	}
	</script>
</head>

<body onload="load()">
	<h1><a href="/">Casual ARMS</a></h1>
	<div id="container" class="container-dark">
		
		<h2>Leaderboards</h2>
		
		<p>Casual ARMS are officially tracking your <img class='armscoin-text' src='coin.png'/> coins throughout every major <a href="/lobbies/"><em>lobby event</em></a> we hold! At the moment, this is just the <a href="/lobbies/#wednesday">Wednesday</a>, <a href="/lobbies/#thursday">Thursday</a>, and <a href="/lobbies/#saturday">Saturday</a> lobbies, but there will be more main events in the future! As every 20 coin lobby <em>finishes</em>, a screenshot of the <img class='armscoin-text' src='coin.png'/> coins acquired will be logged and the totals recorded. Those coins will add to your totals for the server leaderboard, displayed here! (New roles will be revealed as they are acquired.)</p>
		
		<h3>Badges</h3>
		
		<p>Members of the Casual ARMS <a href="https://discord.gg/5A7QkPC"><em class="discord-bg">Discord server</em></a> can now collect badges from different activities! Badges are awarded for leaderboard progression and <a href='https://www.patreon.com/CasualARMS'><em style="background-color: #f36b61;">Patreon</em></a> support, amond other things, and new badges will be unveiled regularly! Click on an entry in the leaderboard listings to view their badge stash.</p>
		
		<p id="mode-selector">
			<em class="mode active-mode" id="md0" onClick="changeMode(0);">Leaderboard</em>
			<em class="mode" id="md1" onClick="changeMode(1);">Monthly</em>
			<em class="mode" id="md2" onClick="changeMode(2);">Patrons</em>
		</p>
		
		<div id="leaderboard"></div>
		<br/>
		<div id="sponsor"><span>Casual ARMS leaderboards are sponsored by<br/>ARMS Laboratories, Inc.</span><img src="arms-labs.png"/>
	</div>
</body>
</html>
